<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/core-ajax/core-ajax.html">
<link rel="import" href="../services/task-list-service.html">
<link rel="import" href="../bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="../bower_components/core-icons/core-icons.html">
<link rel="import" href="../bower_components/core-toolbar/core-toolbar.html">
<link rel="import" href="../bower_components/core-animated-pages/core-animated-pages.html">
<link rel="import" href="task-list-quickview.html">
<link rel="import" href="task-list-overview.html">

<polymer-element name="list-container" attributes="tasklists,isVisible,selectedindex">
    <template>
        <style>

        	:host{
        		min-height: 800px;
        		height: 100%;
        		width: 100%;
        	}
        	.task-list {
                margin: 10px;
                width: 400px;
                height: 100%;
            }

          
            #pages{
            	height: 100%;
            	
            }


        </style>
        <core-toolbar class="toolbar">
            <paper-icon-button on-tap="{{_fnAddorBack}}" icon="{{$.pages.selected != 0 ? 'arrow-back' : 'add'}}"></paper-icon-button>
        </core-toolbar>


        <task-list-service taskLists="{{tasklists}}"></task-list-service>
        <core-animated-pages id="pages" vertical layout selected="0" on-core-animated-pages-transition-end="{{transitionend}}" transitions="cross-fade-all hero-transition" >

        
    		<section>
                <div horizontal wrap layout>
                    <template repeat="{{tasklist, index in tasklists}}">
                        <task-list-quickview
                         tasklist="{{tasklist}}"
                         hero-id="item-{{index}}" 
                         hero
                         index="{{index}}"
                         on-overview="{{selectView}}"
                         class="task-list"
                         on-delete-list="{{deleteList}}"
                         >
                         </task-list-quickview>
                    </template>
                </div>
			</section>

            <section vertical layout justified center>
                <task-list-overview tasklist="{{selectedtasklist}}" hero-id="item-{{selectedindex}}" hero></task-list-overview>
            </section>

        </core-animated-pages>

        <!--<task-list-overview id="dialog" tasklist="{{selectedlist}}"></task-list-overview>-->
    </template>

    <script>
        Polymer({
        	_fnAddorBack:function(){
        		if(this.$.pages.selected != 0){
        			this.back(arguments);
        		}else{
        			this.createNewList(arguments);
        		}
        	},
            createNewList: function(event, detail, sender) {
                this.tasklists.push({
                    'items': []
                });

            },
            deleteList: function(event, detail, sender) {
            	var i = event.target.templateInstance.model.index;
            	this.tasklists.splice(i,1);
            },
            selectView: function(event, detail, sender) {
                var i = event.target.templateInstance.model.index;
                this.selectedindex = i;
                this.selectedtasklist = this.tasklists[i];

                this.$.pages.selected = 1;
            },
            transitionend: function() {
                if (this.lastSelected) {
                    this.lastSelected = null;
                }
            },
            back: function() {
                this.lastSelected = this.$.pages.selected;
                console.log(this.lastSelected);
                this.$.pages.selected = 0;
            }


        });
    </script>
</polymer-element>
